<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Addon Manager</title>
</head>
<body>
    <div class="container">
        <div id="addon-list">
            <h3>List of Addons</h3>
            <ul id="addons">
                <!-- Les addons seront listés ici -->
            </ul>
        </div>
        <div id="addon-config">
            <h3>Addon Configuration</h3>
            <div id="config-editor">
                <!-- La configuration sera affichée ici -->
            </div>
        </div>
    </div>
</body>

<script>
    // Fonction pour charger les configurations des addons
    function loadConfig(addon) {
        window.pywebview.api.load_config(addon).then(config => {
            const editor = document.getElementById('config-editor');
            editor.innerHTML = ''; // Nettoyage de l'éditeur avant de recharger

            for (let key in config) {
                const div = document.createElement('div');
                div.classList.add('config-item');

                // Déterminer l'input en fonction de inputType
                if (config[key].inputType === 'slider') {
                    const label = document.createElement('label');
                    label.textContent = `${key} (${config[key].varType})`;
                    const input = document.createElement('input');
                    input.type = 'range';
                    input.min = config[key].min;
                    input.max = config[key].max;
                    input.value = config[key].value;
                    input.step = config[key].varType === 'float' ? "0.01" : "1";  // Ajuste le pas en fonction du type

                    input.oninput = () => config[key].value = parseFloat(input.value); // Pour les floats/int
                    div.appendChild(label);
                    div.appendChild(input);
                } else if (config[key].inputType === 'color') {
                    const label = document.createElement('label');
                    label.textContent = `${key} (${config[key].varType})`;
                    const input = document.createElement('input');
                    input.type = 'color';
                    input.value = config[key].value;

                    input.oninput = () => config[key].value = input.value; // Pour les couleurs (string)
                    div.appendChild(label);
                    div.appendChild(input);
                }

                editor.appendChild(div);
            }

            // Bouton de sauvegarde
            const saveButton = document.createElement('button');
            saveButton.textContent = 'Save Config';
            saveButton.onclick = () => window.pywebview.api.save_config(addon, config);
            editor.appendChild(saveButton);
        });
    }

    // Fonction pour vérifier si PyWebView est prêt
    function checkPyWebViewReady() {
        if (window.pywebview && window.pywebview.api) {
            console.log('PyWebView is ready');
            window.pywebview.api.get_addons().then(addons => {
                const ul = document.getElementById('addons');
                addons.forEach(addon => {
                    const li = document.createElement('li');
                    li.textContent = addon;
                    li.onclick = () => loadConfig(addon);
                    ul.appendChild(li);
                });
            });
        } else {
            console.log('PyWebView is not ready, retrying...');
            setTimeout(checkPyWebViewReady, 100);  // Re-vérifie toutes les 100 ms
        }
    }

    // Lancer la vérification lorsque le DOM est chargé
    document.addEventListener('DOMContentLoaded', function() {
        checkPyWebViewReady();
    });
</script>
</html>
