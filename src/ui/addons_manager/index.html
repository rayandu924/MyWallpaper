<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Addon Manager</title>
</head>
<body>
    <div class="container">
        <div id="addon-list">
            <h3>List of Addons</h3>
            <ul id="addons">
                <!-- Les addons seront listés ici -->
            </ul>
        </div>
        <div id="addon-config">
            <h3>Addon Configuration</h3>
            <div id="config-editor">
                <!-- La configuration sera affichée ici -->
            </div>
        </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
<script>
    let currentAddon = null;
    let addonOrder = [];

    // Fonction pour charger les configurations des addons
    function loadConfig(addon) {
        currentAddon = addon;
        window.pywebview.api.load_config(addon).then(config => {
            const editor = document.getElementById('config-editor');
            editor.innerHTML = ''; // Nettoyage de l'éditeur avant de recharger

            for (let key in config) {
                const div = document.createElement('div');
                div.classList.add('config-item');

                if (config[key].inputType === 'slider') {
                    const label = document.createElement('label');
                    label.textContent = `${key} (${config[key].varType})`;
                    const input = document.createElement('input');
                    input.type = 'range';
                    input.min = config[key].min;
                    input.max = config[key].max;
                    input.value = config[key].value;
                    input.step = config[key].varType === 'float' ? "0.01" : "1"; 

                    input.oninput = () => {
                        config[key].value = parseFloat(input.value);
                        saveConfig(config);
                    };

                    div.appendChild(label);
                    div.appendChild(input);
                } else if (config[key].inputType === 'color') {
                    const label = document.createElement('label');
                    label.textContent = `${key} (${config[key].varType})`;
                    const input = document.createElement('input');
                    input.type = 'color';
                    input.value = config[key].value;

                    input.oninput = () => {
                        config[key].value = input.value;
                        saveConfig(config);
                    };

                    div.appendChild(label);
                    div.appendChild(input);
                }

                editor.appendChild(div);
            }
        });
    }

    function saveConfig(config) {
        window.pywebview.api.save_config(currentAddon, config);
    }

    function enableDragAndDrop() {
        const list = document.getElementById('addons');
        new Sortable(list, {
            animation: 150,
            onEnd: () => {
                const order = Array.from(list.children).map(li => li.textContent);
                addonOrder = order;
                window.pywebview.api.save_addon_order(order);
            }
        });
    }

    // Fonction pour vérifier si PyWebView est prêt
    function checkPyWebViewReady() {
        if (window.pywebview && window.pywebview.api) {
            window.pywebview.api.get_addons().then(addons => {
                const ul = document.getElementById('addons');
                ul.innerHTML = ''; // Réinitialiser la liste d'addons

                addons.forEach(addon => {
                    const li = document.createElement('li');
                    li.textContent = addon;
                    li.onclick = () => loadConfig(addon);
                    ul.appendChild(li);
                });

                enableDragAndDrop();
            });
        } else {
            setTimeout(checkPyWebViewReady, 100);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        checkPyWebViewReady();
    });
</script>
</html>
